컴퓨터 비전: 기본
분류, 분할, 구분, 추적, 행동 분류
mnist와 cifar-10은 어려운 데이터셋 이었지만 지금은 장난감 수준
ImageNET은 딥거닝 발전에 결정적인 공헌 단일 오브젝트 제공
외국 사이트 https://paperswithcode.com/ 한국 데이터는 https://www.aihub.or.kr/

coco하나의 이미지에 여러 데이터가 들어있음  세그멘테이션이 가능하게끔 마스크 제공 이것도 많이 쓰임
openImages 물체에대한 텍스트 설명이 잇는 데이터셋

DeepFashion은 옷 분류
food 101 음식
cheXpert 폐 엑스레이 사진

합리적이고 공정한 성능 평가 척도 metric가 중요
세부 문제에 따라 중요한 척도

영상 레이블링 robotlabeling
많은 도구 존재 
labelme
대용량 데이터 셋은 클라우소싱을 활용하여 제작 (예, mechanical Truk)

사람과 컴퓨터 비전은 인식하는 방식이 크게 다름
예 사람은 검출을 따로 수행하지 않고 분할만 수행하는 반면에 컴퓨터 비전은 보다 쉬운 검출 문제를 중요하게 취급(검출은 자율주행에서 중요)
사람의 인식
세무 문제를 별도 수행하지 않고 동시 수행. 지식과 추론 등의 지능 요쇼를 통해 명확한 의도(intenttion)를 지님

컴퓨터 비전의 인식
세부문제별로 독립적으로 해결. 대상 물체 또는 응용 과업에 따라 더욱 세부적인 문제로 구분하여 해결
능동적인 의도가 없음
과업이 달성할 목적이 의도를 대신하며, 목적을 데이터 레이블링에 반영되하 수준
사례분류와 범주분류
사례 분류 모양과 텍스쳐가 고정된 특정 물체를 분류
범주 분류:코끼리나 자전거 같은 일반 부류의 물체를 분류(모양과 자세 변화가 심함)
물체를 구성하는 직선과 곡선을 분석하는 기하학적 방법이 주류
블록세계,일반실린더,acronym,양상그래프
2000년대초에 sift 특징 추출 알고리즘과 ransac매칭 알고리즘에 힘입어 획기적으로 발전하고 실용 시스템 등장

범주 분류
부류내 변화가 아주 심함 (뛰거나 누운 혹은 뒤태만 보이는 고양이)
혼재와 가림을 허용하므로 더욱 어류움
pascal voc 대회가 연구 촉발. 대표적인 고전 방법은 부붐 기반 방법

딥러닝에서는 사례 분류는 풀렸다고 보고 범주분류에 공을 들임
ILSVRC 대회 에서는 1~2회는 고전방법이 우승하였으니 3회에 컨볼루션 신경망 기반의 alexnet이 우승함에 따라 이후 딥러닝으로 패러다임 전환

미세 분류 문제
부류 내 변화가 크로, 부류간 변화가 적어 아주 어려운 문제
stanford dogs,stanford cars, cub-200,iNat,oxford 102 flowers

설명 가능
인간은 의사결정의 이유를 설명하는 능력이 뛰어남
딥러닝은 분류 결과에 대한 이류를 설명하지 못하는 치명적 한계
설명 가능확보하려는 연구 활발:CAM과 GradCAM
weight가 어디에 포커스 되어있는지 캠으로 표시가됨
가중치가 높으면 중요한 특성이기에 이걸 attention이라고 함 그리고 그부분을 표시해줌

적대적 굥력 adversial attack과 방어 전략
딥러닝 모델을 속이려는 시도가 쉽게 통함 버스 영상에 잡음을 섞으면 타조라고 분류하는 예시
적대적 공격을 막는 연구 활발
Digital attack 과 physical attack이 있음 예) 교통 표지판에 스티커 부착

검출 문제
물체의 위치와 함계 부류 저오브를 알아내야 하므로 분류보다 어려움
검출 알고리즘은 물체위치와 함께 분류confidence를 나타내는 확률 벡터를 출력
딥러닝으로 전환하면서 획기적 발전 이름(ex 자율주행차)
성능 척도로는 coco대회의 mAP를 주로 사용
먼저 물체를에 대한 AP계산 방법을 설명
AP는 IoU를 기반으로 계산
참값과 예측값 간의 겹치는 정도를 계산 Iou = 교집합/합집합
신뢰도 임계값에 따른 기준을 통한 박스만 예측 목록에 넣음
예측 목록에 있는 박스를 신회도가 큰 것부터 순서대로 처리
Iou 임계값에 따라 TP, FP으로 판정
참 금정이 발생하면 쌍이 된 참값 박스를 참값 목록에서 제거
예측 목록을 다 처리했지만 쌍을 맺지 못해 남아 있는 참값 박스는 FN
정밀도: tp/(tp+fp), 재현율: tp/(tp+fn)

후보 영역에서 HOG 특징 추출과정
후보영역을 128 * 64로 변환 8*8크기로 나누어 16*8갸의 타일 새엇ㅇ
타일에서 특징 추출 과정
53개 화서에서 그레디언트 방향 계산하고 9개 구간으로 양자화
히스토그램을 구해 9차원 특징 벡터 구성
4개 이웃 타이을을 이어 붙이 36차원 특징 벡터 정규화

후보 영억에서는 svm 분류기 사용
슬라이딩 윈도우 사용
DPM 등장
물체를 몇 개의 부품으로 모델링

컨볼루션 신경망:RCNN 계역
딥러닝으로 전환
초기 ILSVRC 대회 검출 부문에서느 고전 방법론이 우승했는데 2014 컴볼루션 신경망을 사용한 RCNN이 우승하여 검출에서 컨볼루션 신경망 시대를 열다
두단계 방법론과 한단계 방법론
RCNN이 대표하는 두단계 방법: 후보 영역을 생성하고 분류를 통해 물체 여부 판정 faster RCNN, mask RCNN
YOLO가 대표하는 한단계 방법 위치와 부류 정보를 묶어 참값을 만들고 신경

RCNN 처리과정
영역 제안(후보 영역 생성)
selective search을 이용 (슈퍼 화서 분할한 다음 군집화를 통해 후보 영역 생성)

영역 분류 단계
227*227로 정규화 하고 컨볼루션 신경망으로 4096차원특징 추출
svm으로 영역 분류

RCNN은 물체 검출에 컨볼루션 신경망을 도입한 점에서 혁신적

fast RCNN의 처리 과정
영역제안은 여전히 선택적 알고리즘 사용
영역 분류는 신경망 사용
컨볼류선 층으로특징 추출
완전연결층으로 분류(부류 확률 벡터)와 회귀(박스 위치)
분류와 회귀를 한꺼번에 학습
VGGNET이나 GoogLeNet을 미세조정하여 전이 학습
한계
선택적 탐색은 한 장 영상처리하는데 cpu에서 2초 가량 소요
영역 제안 단계가 병목

faster RCNN의 처리 과정
영역 제안을 RPN으로 수행. 속도와 정확률을 획기적으로 개선
2015년 ILSVRC와 COCO 대회 우승하여 컨볼루션 신경망만으로 검출하는 시대 열다
3*3 필터로 추출한 512 차원 특징벡터에
1*1 컨볼루션 적용하여 물체 여부와 박스 정보 추출
9번 적용하여 9개 앵커 생성

YOLO는 RCNN보다 정확률이 떨어지지만 월등히 빠름
물체 위치와 부류 정보를 회귀를 통해 한꺼번에 알나내는 한단계 방법
영상을 s*s 격자로 분할
물체 중심에 해당한 칸이 물체를 책임짐

학습 90 차원 벡터는 박스 정보와 원핫 코드의 부류 정보가 섞여 있음
5개 항으로 구성된 손실 함수 사용하여 통째 학습

YOLO의 버전업
v3는 여러 스케일을 표현하여 다양한 크기의 물체 검출

고전 알고리즘
4.4절(정규화 절단 등)과 4.5절(GrabCut 등)
6장 [프로그램 6-3]의 오림 비전 에이전트: 관심 물체 잘라내기
분할된 영역이 어떤 물체인지 알아내지 못하는, 즉 의미를 모르는 분할 알고리즘
딥러닝이 등장하면서 경쟁력 상실

딥러닝 분할
셀 수 있는 thing물체(자동차, 사람등), 셀 수 없는 stuff물체(하늘, 도로 등)
셀 수 있는 thing 물체(자동차, 사람 등), 셀 수 없는 stuff 물체(하늘, 도로 등)
의미 분할semantic segmentation: 모든 화소에 부류 할당(thing과 stuff 모두 분할), 같은 부류는 구분하지 않음
사례 분할instance segmentation: thing만 분할, 같은 부류 물체 여럿이면 번호 붙여 구분
총괄 분할panoptic segmentation: 모든 화소에 부류 할당(thing과 stuff 모두 분할), 같은 부류 물체가 여럿이면 번호 붙여 구분

분할을 밀집 분류 문제로 간주하고 분류 척도 사용
분할은 화소마다 부류를 지정하는 문제로 볼 수 있음
화소 정확률 PA로 성능 측정 가능
부류별 PA의 평균이 평균 화소 정확률 MPA

IOU(교집합/합집합)와DICE가 좀더 최신 자주 쓰임

분할 데이터셋
[그림 9-4]가 소개한 PASCAL VOC, ImageNet, COCO, OpenImages는 분할 레이블 제공
특수 목적 또는 확장된 데이터셋
도심 도로 장면 분할 Cityscapes
유튜브 비디오 분할 Youtube-Objects
자율주행 KITTI
RGB-D 분할 NYU-Depth V2
COCO 확장한 LVIS

FCN은 분할을 처음 시도한 성공적인 컨볼루션 신경망
이후 다양한 아이디어로 개선된 뛰어난 성능의 모델이 여럿 등장
이름이 뜻하듯이 컨볼루션층만으로 구성됨

구조와 동작
입력은 m*n*3 컬러 영상, 출력은 m*m*(C+1) 맵
출력 맵의 각 화소는 C+1차원의 부류 확률 벡터(C개 부류+배경)
출력층은 화소별로 softmax 적용하여 확률 벡터 출력
참값은 화소별로 원핫 코드 표현 
각 텐서의 동일한 위치에 부류에 따라 확률이 0~1이 존재함 다 더하면 1인데 그중 가장 큰 값으로 분류함

다운 샘플링과 업 샘플링
FCN은 다운 샘플링으로 맵 크기를 줄인 다음 업 샘플링으로 원래 크기 복원
업 샘플링을 어떻게 달성할 것인가?
양선형 보간법([그림 3-22])을 채택하면 다운 샘플링은 학습으로 수행하고 업 샘플링은 고전 방법을 사용하는 꼴
FCN은 전치 컨볼루션으로 업 샘플링 달성

FCN의 성공 이후 다양한 변형 신경망등장
DeConvNet
오토인코더와 FCN을 결합한 형태(인코더는 다운 샘플링, 디코더는 업샘플링 담당)
FCN에 비해 학습이 세련되고 성능도 우월
U-net 의료 영상 분할을 목저긍로 개발되어 지금은 자연영상에까지 널리 사용됨
다른 신경망처럼 다운 샘플링과 업 샘플링을 수행함
가장 특이한 점은 지름길 연결(특징 맵을 이어 붙이는 지름길 연결)

DeepLabv3
인코더와 디코더에 기반한 신경망으은 영상을 상당히 작게 축소했다가 복원하기 때문에 상세 내용 잃을 가능성 높음
DeepLabv3+는 팽창 컨볼루션을 이용하여 이런 단점을 누그러뜨림

pixellib 라이브러리
의미 분할과 사례 분할을 지원
의미 분할은 DeepLabv3+로 구현. 20부류를 지원하는 PASCAL VOC 버전과 150부류를 지원하는 Ade20K 버전 제공
사례 분할은 mask RCNN으로 구현. COCO 데이터셋으로 학습
다양한 기능 제공
정지 영상 버전과 비디오 버전
분할 결과를 디스플레이하는 여러 방식과 파일 저장 기능 등을 제공하여 적은 행으로 쉽게 프로그래밍 가능

프로그래밍 추상화 수준에 대한 토론
pixellib은 추상화 수준이 높아 10여 행의 코드로 분할 결과를 얻을 수 있음
개발자는 여러 편리한 기능을 제공할 수 있게 클래스와 함수 설계
COCO 데이터셋으로 학습했기 때문에 COCO에 없는 부류는 처리할 수 없는 한계
pixellib은 자체 데이터셋으로 재학습하는 기능 제공. 하지만 모델 구조나 하이퍼 매개변수를 자유자재로 조정하는데 한계 
[프로그램 9-4]의 U-net 구현은 프로그램이 길지만, 모델이나 하이퍼 매개변수를 자유자재로 조절하여 맞춤 모델 제작할 수 있는 장점

비전 에이전트 제작
pixellib은 분할된 물체 영역만 남기고 나머지를 배경으로 간주하여 원하는 처리를 할 수 있는 기능을 제공
이 기능을 이용하여 배경을 흐릿하게 하거나 색을 바꾸는 등의 기능을 구현
[프로그램 6-7]의 특수 효과를 적용하는 비전 에이전트를 수정하여 재활용

사람 인식은 가장 많은 관심과 연구 진행
인증,보안,고객 분석,스포츠 등 으용이 무궁무진
스마트 기기 로그인 등 상용화 시스템 등장
고전 방법에서 가장 성공적인 고유 얼굴eigen face 기법
얼굴 영상에 주성분 분석을 적용하여 차원을 줄인 다음 매칭 알고리즘으로 인식
당시에는 획기적 진전
정면 얼굴에 적용할 수 있는 한계(LFW 데이터셋에서 정확률 95%, 그 이상 돌파 못함)
 컨볼루션 신경망 시대
2014년 AlexNet을 백본으로 사용한 DeepFace는 LFW에서 97.35% 달성하여 사람 수준에 근접
이후 VGGNet을 백본으로 사용한 VGGFace, GoogLeNet을 사용한 FaceNet, Resnet을 사용한 SphereFace 등이 99.8% 달성

얼굴 확인face verification과 얼굴 식별face identification
얼굴 확인은 두 장의 얼굴이 동일인인지 확인하는 문제(예, 공항 여권 검사)
얼굴 식별은 입력 영상을 등록된 영상과 매칭하여 누구인지 알아내는 문제
얼굴 인식은 미세 분류 문제의 일종
손실 함수를 잘 설계하여 성능 향상 모색
같은 부류 영상은 유사도 높게 유지하고 다른 부류는 낮게 유지하는 손실 함수
Contrastive 손실 함수, triplet 손실 함수, center 손실 함수 등이 개발됨

얼굴 검출 -> 정렬 -> 생성 -> 특징 추출 -> 매칭
Yale face.LFW,MegaFace,VGG face

성별과 나이 추정 데이터셋
MORPH II: 16~77세인 얼굴 영상 55,134장. 인종과 성별 레이블도 있음
IMDB-WIKI: 연예인의 성별과 나이를 레이블링한 50만 장 이상의 영상
AFADAsian Face Age Dtaset: 성별과 나이 레이블을 가진 아시아인 얼굴 영상 16만장 
UTKface: 0~116세에 대해 나이, 성별, 인종을 레이블링한 23,708장의 얼굴 영상

나이 추정은 주로 순서형 회귀 문제로 취급
다중 출력층 사용, 여러 신경망 사용, 이동 윈도우 회귀